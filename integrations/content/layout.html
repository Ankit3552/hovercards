<div class="{{#if content.video}}
	{{ _.prefix('content-video') }}
{{elseif content.gif}}
	{{ _.prefix('content-gif') }}
{{elseif content.images || content.content}}
	{{ _.prefix('content-images') }}
{{elseif content.image}}
	{{ _.prefix('content-image') }}
{{else}}
	{{ _.prefix('content-text') }}
{{/if}} {{ _.prefix('content-' + content.api) }}">
	{{#if content}}
		<div class="{{ _.prefix('content') }} {{ content.loading ? _.prefix('loading-parent') : '' }}">
			{{#if content.loading}}
				<div class="{{ _.prefix('loading') }}"></div>
			{{elseif content.loaded}}
				<catch-errors object="{{ content }}">
					<content-header></content-header>
					{{#if has_media(content) || content.api !== content_api }}
						<content-text></content-text>
					{{/if}}
					{{>content.api+'-content'}}
				</catch-errors>
			{{/if}}
		</div>
		{{#if message}}
			<messaging message="{{ message }}"></messaging>
		{{/if}}
		<div class="{{ _.prefix('discussion') }}
		            {{ scrollpos > 20 && scrollposbottom > 20 ? _.prefix('discussion_fixed') : '' }}
		            {{ scrollposbottom <= 20 ? _.prefix('discussion_at-bottom') : '' }}"
		     style="{{ scrollpos > 20 && scrollposbottom > 20 ? 'right: ' + boxmargin + 'px !important;' : '' }}">
			<div class="{{ _.prefix('testing') }}">
				{{#with expanded ? (discussions[discussion_i].loaded && !discussions[discussion_i].err && discussions[discussion_i].content) || (content.api === discussions[discussion_i].api && content) :
				                   (content.loaded && !content.err && content) }}
					{{#if .}}
						<div class="{{ _.prefix('discussion__header') }}">
							{{>(api+'-discussion-header') { content: ., content_api: ../api }}}
						</div>
					{{/if}}
				{{/with}}
				
				{{#if discussions && discussions[discussion_i]}}
					<div class="{{ _.prefix('flex-spread') }} {{ _.prefix('account-switcher') }}">
						<div class="{{ _.prefix('tabs') }}">
							{{#each discussions:i}}
								<span on-click="analytics('send', 'event', 'discussion displayed', 'link clicked', _.analytics_label(content), i)">
									<span on-click="set('discussion_i', i)"
										  class="{{ _.prefix('tabs__tab') }}
												 {{ i === discussion_i ? _.prefix('tabs__tab_selected') : '' }}">
										{{ copy(.api) }}
									</span>
								</span>
							{{/each}}
						</div>
					</div>
					<div class="{{ _.prefix('discussion__body') }}">
						{{#if discussions[discussion_i].loading}}
							<div class="{{ _.prefix('loading') }}"></div>
						{{elseif discussions[discussion_i].loaded}}
							<discussion-catch-errors object="{{ discussions[discussion_i] }}">
								{{>discussions[discussion_i].api+'-discussion' { discussion: discussions[discussion_i] }}}
							</discussion-catch-errors>
						{{/if}}
					</div>
				{{/if}}
			</div>
		</div>
	{{/if}}
</div>
